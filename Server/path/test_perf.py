import requests
import time

# [long1,lat1,long2,lat2, distance] 
_test_data = [
[ 73.35875899999999 , 22.6843011 , 73.9961854 , 18.5610789 , 461298.84396246 ],
[ 73.35875899999999 , 22.6843011 , 75.9917895 , 20.88684 , 337266.01438799 ],
[ 73.35875899999999 , 22.6843011 , 72.47064379999999 , 22.9669356 , 96391.24265243 ],
[ 70.7916122 , 22.2523996 , 73.0377602 , 18.999006299999998 , 429561.81226132 ],
[ 73.9114866 , 17.6799253 , 73.2905674 , 22.2665673 , 511900.46417003 ],
[ 74.24930979999999 , 16.7037706 , 75.445853 , 19.822419099999998 , 367636.03466571 ],
[ 73.8837351 , 15.5753224 , 73.9961854 , 18.5610789 , 330650.96472607 ],
[ 73.35875899999999 , 22.6843011 , 75.445853 , 19.822419099999998 , 383821.1882097 ],
[ 74.08917819999999 , 18.555028699999998 , 73.9961854 , 18.5610789 , 9839.77284585 ],
[ 70.7907188 , 22.264263399999997 , 73.2905674 , 22.2665673 , 257653.8203038 ],
]
class APISpeedTest():
    def perf_helper(self,long1,lat1,long2,lat2):
        url = f"http://localhost:8000/path/{long1},{lat1};{long2},{lat2}"
        start_time = time.time()
        requests.get(url)
        end_time = time.time()
               
        duration = end_time -start_time
        return duration
    def test_perfs(self):
        result = []
        for case in _test_data:
            dur = self.perf_helper(*case[:-1])
            result.append((case[-1], dur))
        print(result)
        
            
a = APISpeedTest()
a.test_perfs()

# Result 1  [(distance, time taken)]
# [(461298.84396246, 12.968502759933472), (337266.01438799, 11.02419924736023), (96391.24265243, 11.157000541687012), (429561.81226132, 11.909505128860474), (511900.46417003, 12.213010311126709), (367636.03466571, 14.916117668151855), (330650.96472607, 11.743092775344849), (383821.1882097, 11.375532388687134), (9839.77284585, 12.169137716293335), (257653.8203038, 13.792380332946777)]     

# Result 2  [(distance, time taken)]
# Adding Spatial Index to nodes and limiting amount of nodes searched using ST_DWITHIN
# [(461298.84396246, 8.587481498718262), (337266.01438799, 8.648917198181152), (96391.24265243, 9.148687601089478), (429561.81226132, 10.966825008392334), (511900.46417003, 8.845225811004639), (367636.03466571, 9.963709115982056), (330650.96472607, 9.598915100097656), (383821.1882097, 8.694976568222046), (9839.77284585, 9.117139101028442), (257653.8203038, 11.843034505844116)]

# Result 3
# Bounding box using geom_way (skipped profiling using wkt because it slows the program down)
# [(461298.84396246, 8.084707975387573), (337266.01438799, 5.377027988433838), (96391.24265243, 5.709301948547363), (429561.81226132, 8.168816804885864), (511900.46417003, 5.473551273345947), (367636.03466571, 6.523441314697266), (330650.96472607, 5.309800863265991), (383821.1882097, 5.509366512298584), (9839.77284585, 5.405071496963501), (257653.8203038, 6.872111082077026)]

# Result 4
# Prev but with index on geom way
# [(461298.84396246, 5.297147750854492), (337266.01438799, 6.272458553314209), (96391.24265243, 6.495592355728149), (429561.81226132, 17.723862171173096), (511900.46417003, 7.958581209182739), (367636.03466571, 9.176978588104248), (330650.96472607, 5.716793060302734), (383821.1882097, 8.72641634941101), (9839.77284585, 6.376532316207886), (257653.8203038, 8.305368900299072)]
